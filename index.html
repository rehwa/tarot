<!DOCTYPE html>
<html lang="ko">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarot BCR</title>
    <style>
	:root {
	    --primary-color: #4a90e2;
	    --secondary-color: #f5f5f5;
	    --text-color: #333;
	    --border-color: #dee2e6;
	    --error-color: #dc3545;
	    --success-color: #28a745;
	}
	
	body {
	    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
	    max-width: 800px;
	    margin: 0 auto;
	    padding: 15px;
	    background-color: var(--secondary-color);
	    color: var(--text-color);
	}
	
	.subtitle {
	    text-align: center;
	    color: #999;
	    font-size: 14px;
	    margin-top: -15px;
	    margin-bottom: 20px;
	    font-weight: bold;
	}
	
	.container {
	    background-color: white;
	    padding: 20px;
	    border-radius: 15px;
	    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
	}
	
	h1 {
	    font-size: 24px;
	    margin-bottom: 20px;
	    text-align: center;
	}
	
	.input-group {
	    margin-bottom: 25px;
	}
	
	.radio-group {
	    display: flex;
	    justify-content: center;
	    gap: 20px;
	    margin-bottom: 20px;
	}
	
	.radio-group label {
	    display: flex;
	    align-items: center;
	    gap: 8px;
	    font-size: 16px;
	    padding: 8px 16px;
	    background-color: var(--secondary-color);
	    border-radius: 20px;
	    cursor: pointer;
	}
	
	.radio-group input[type="radio"] {
	    width: 20px;
	    height: 20px;
	}
	
	.date-inputs {
	    display: grid;
	    grid-template-columns: repeat(3, 1fr);
	    gap: 10px;
	    margin: 15px 0;
	}
	
	select {
	    width: 100%;
	    padding: 12px;
	    font-size: 16px;
	    border: 2px solid var(--border-color);
	    border-radius: 10px;
	    background-color: white;
	    -webkit-appearance: auto;
	    appearance: auto;  
	    height: 48px;
	    cursor: pointer;
	}
	
	select:focus {
	    outline: none;
	    border-color: var(--primary-color);
	    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
	}
	
	.card-result {
	    display: grid;
	    grid-template-columns: 1fr;
	    gap: 15px;
	}
	
	.card {
	    background-color: var(--secondary-color);
	    padding: 20px;
	    border-radius: 12px;
	    border: 1px solid var(--border-color);
	    display: flex;
	    flex-direction: column;
	}
	
	.card h3 {
	    margin-top: 0;
	    color: var(--primary-color);
	    border-bottom: 2px solid var(--border-color);
	    padding-bottom: 10px;
	    font-size: 18px;
	    text-align: center;
	}
	
	.card-content {
	    display: flex;
	    flex-direction: row;
	    align-items: flex-start;
	    gap: 15px;
	}
	
	.card-image {
	    width: 120px;
	    height: 200px;
	    object-fit: contain;
	    border-radius: 8px;
	    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
	}
	
	.card-text {
	    flex: 1;
	}
	
	.date-display {
	    color: #666;
	    font-size: 14px;
	    margin-bottom: 12px;
	    text-align: center;
	}
	
	.card-name {
	    color: var(--primary-color);
	    font-weight: bold;
	    margin: 8px 0;
	    font-size: 16px;
	}
	
	.card-meaning {
	    color: #666;
	    font-size: 14px;
	    line-height: 1.5;
	    margin: 8px 0;
	}
	
	.card-description {
	    color: #333;
	    font-size: 15px;
	    margin: 10px 0;
	    font-weight: bold;
	    text-align: center;
	}
	
	.error-message {
	    color: var(--error-color);
	    font-size: 14px;
	    text-align: center;
	    margin: 10px 0;
	    padding: 10px;
	    background-color: rgba(220, 53, 69, 0.1);
	    border-radius: 8px;
	    display: none;
	}
	
	.error-message:not(:empty) {
	    display: block;
	}
	
	@media (min-width: 768px) {
	    .card-result {
	        grid-template-columns: repeat(2, 1fr);
	    }
	}
	
	@media (max-width: 767px) {
	    .card-content {
	        flex-direction: column;
	        align-items: center;
	    }
	    
	    .card-image {
	        width: 100px;
	        height: 166px;
	        margin-bottom: 10px;
	    }
	}
	
	/* Footer 스타일 */
	.footer {
	    margin-top: 40px;
	    padding: 20px;
	    text-align: center;
	    border-top: 1px solid var(--border-color);
	    font-weight: bold;
	}
	
	.share-buttons {
	    margin-bottom: 20px;
	    display: flex;
	    justify-content: center;
	    gap: 10px;
	}
	
	.share-btn {
	    padding: 10px 20px;
	    border: none;
	    border-radius: 20px;
	    background-color: var(--primary-color);  /* 기본 버튼 색상 (주소복사, 링크공유) */
	    color: white;
	    cursor: pointer;
	    font-size: 14px;
	    transition: background-color 0.3s;
	    display: flex;
	    align-items: center;
	    gap: 8px;
	}
	
	.share-btn.copy-result {
	    background-color: #40c057 !important;  /* 녹색 계열 */
	}
	.share-btn.copy-result:hover {
	    background-color: #40c057 !important;
	}
	
	.share-btn.save-result {
	    background-color: #40c057 !important;
	}
	.share-btn.save-result:hover {
	    background-color: #40c057 !important;
	}
	
	.share-btn.share-result {
	    background-color: #40c057 !important;
	}
	.share-btn.share-result:hover {
	    background-color: #40c057 !important;
	}
	
	.share-btn:hover {
	    background-color: #357abd;
	}
	
	.copyright {
	    color: #666;
	    font-size: 12px;
	}
    </style>
</head>
<body>
    <div class="container">
        <h1>타로 생일 카드 리딩</h1>
	<p class="subtitle">영혼의 거울<br>타로 카드로 보는 당신의 본질</p>
        <div id="errorContainer" class="error-message" role="alert"></div>

        <div class="input-group">
            <div class="radio-group">
                <label>
                    <input type="radio" name="calendarType" value="solar" checked>
                    양력
                </label>
                <label>
                    <input type="radio" name="calendarType" value="lunar">
                    음력
                </label>
            </div>

            <div class="date-inputs">
    		<select id="year" aria-label="년도 선택">
    			<option value="" selected disabled>년도 선택</option>
		</select>
		<select id="month" aria-label="월 선택">
    			<option value="" selected disabled>월 선택</option>
		</select>
		<select id="day" aria-label="일 선택">
    			<option value="" selected disabled>일 선택</option>
		</select>
            </div>
        </div>

	<!-- 카드 결과 섹션 수정 -->
	<div class="card-result">
	    <div class="card">
	        <h3>양력(SOLAR) 카드</h3>
	        <div class="card-description">대외적인 나의 성격, 가치관</div>
		<div class="date-display" id="solarDate">양력: -</div>
	        <div class="card-content">
	            <img src="" alt="Solar Card" class="card-image" id="solarCardImage" style="display: none;">
	            <div class="card-text">
	                <div id="solarCardInfo" class="card-info"></div>
	            </div>
	        </div>
	    </div>
	    <div class="card">
	        <h3>음력(LUNAR) 카드</h3>
	        <div class="card-description">내면의 나의 성격, 가치관</div>
		<div class="date-display" id="lunarDate">음력: -</div>
	        <div class="card-content">
	            <img src="" alt="Lunar Card" class="card-image" id="lunarCardImage" style="display: none;">
	            <div class="card-text">
	                <div id="lunarCardInfo" class="card-info"></div>
	            </div>
	        </div>
	    </div>
	    <div class="card">
	        <h3>그림자(SHADOW) 카드</h3>
	        <div class="card-description">나의 숨겨진 진짜 내면</div>
	        <div class="card-content">
	            <img src="" alt="Shadow Card" class="card-image" id="shadowCardImage" style="display: none;">
	            <div class="card-text">
	                <div id="shadowCardInfo" class="card-info"></div>
	            </div>
	        </div>
	    </div>
	    <div class="card">
	        <h3>소울(SOUL) 카드</h3>
	        <div class="card-description">영적인 내 자신의 모습</div>
	        <div class="card-content">
	            <img src="" alt="Soul Card" class="card-image" id="soulCardImage" style="display: none;">
	            <div class="card-text">
	                <div id="soulCardInfo" class="card-info"></div>
	            </div>
	        </div>
	    </div>
	</div>
	            <!-- 여기에 새로운 footer 추가 -->
        <div class="footer">
            <div class="share-buttons">
                <button onclick="copyUrl()" class="share-btn">
                    <span>주소 복사</span>
                </button>
                <button onclick="shareUrl()" class="share-btn">
	            <span>링크 공유</span>
                </button>
	        <button onclick="copyResult()" class="share-btn copy-result" id="copyBtn">
	            <span>결과 복사</span>
	        </button>
	        <button onclick="saveImage()" class="share-btn save-result" id="saveBtn">
	            <span>결과 저장</span>
	        </button>
	        <button onclick="shareResult()" class="share-btn share-result" id="shareBtn">
	            <span>결과 공유</span>	
                </button>
            </div>
            <div class="copyright">
                LENA Academy & Curated by REHWA HONGDAN, in the JWF<br>
		© 2025 JWF. All rights reserved.
            </div>
        </div>
    </div>

    <script>
        const yearSelect = document.getElementById('year');
        const monthSelect = document.getElementById('month');
        const daySelect = document.getElementById('day');
        // 음력 달력 배열 상수 정의
        const currentYear = new Date().getFullYear();
        const LUNAR_LAST_YEAR = 1939;
        const lunarMonthTable = [
            [2, 2, 1, 1, 2, 1, 1, 2, 1, 2, 1, 2],   /* 양력 1940년 1월은 음력 1939년에 있음 그래서 시작년도는 1939년*/
            [2, 2, 1, 2, 1, 2, 1, 1, 2, 1, 2, 1],
            [2, 2, 1, 2, 2, 4, 1, 1, 2, 1, 2, 1],   /* 1941 */
            [2, 1, 2, 2, 1, 2, 2, 1, 2, 1, 1, 2],
            [1, 2, 1, 2, 1, 2, 2, 1, 2, 2, 1, 2],
            [1, 1, 2, 4, 1, 2, 1, 2, 2, 1, 2, 2],
            [1, 1, 2, 1, 1, 2, 1, 2, 2, 2, 1, 2],
            [2, 1, 1, 2, 1, 1, 2, 1, 2, 2, 1, 2],
            [2, 5, 1, 2, 1, 1, 2, 1, 2, 1, 2, 2],
            [2, 1, 2, 1, 2, 1, 1, 2, 1, 2, 1, 2],
            [2, 2, 1, 2, 1, 2, 3, 2, 1, 2, 1, 2],
            [2, 1, 2, 2, 1, 2, 1, 1, 2, 1, 2, 1],
            [2, 1, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2],   /* 1951 */
            [1, 2, 1, 2, 4, 2, 1, 2, 1, 2, 1, 2],
            [1, 2, 1, 1, 2, 2, 1, 2, 2, 1, 2, 2],
            [1, 1, 2, 1, 1, 2, 1, 2, 2, 1, 2, 2],
            [2, 1, 4, 1, 1, 2, 1, 2, 1, 2, 2, 2],
            [1, 2, 1, 2, 1, 1, 2, 1, 2, 1, 2, 2],
            [2, 1, 2, 1, 2, 1, 1, 5, 2, 1, 2, 2],
            [1, 2, 2, 1, 2, 1, 1, 2, 1, 2, 1, 2],
            [1, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1],
            [2, 1, 2, 1, 2, 5, 2, 1, 2, 1, 2, 1],
            [2, 1, 2, 1, 2, 1, 2, 2, 1, 2, 1, 2],   /* 1961 */
            [1, 2, 1, 1, 2, 1, 2, 2, 1, 2, 2, 1],
            [2, 1, 2, 3, 2, 1, 2, 1, 2, 2, 2, 1],
            [2, 1, 2, 1, 1, 2, 1, 2, 1, 2, 2, 2],
            [1, 2, 1, 2, 1, 1, 2, 1, 1, 2, 2, 2],
            [1, 2, 5, 2, 1, 1, 2, 1, 1, 2, 2, 1],
            [2, 2, 1, 2, 2, 1, 1, 2, 1, 2, 1, 2],
            [1, 2, 2, 1, 2, 1, 5, 2, 1, 2, 1, 2],
            [1, 2, 1, 2, 1, 2, 2, 1, 2, 1, 2, 1],
            [2, 1, 1, 2, 2, 1, 2, 1, 2, 2, 1, 2],
            [1, 2, 1, 1, 5, 2, 1, 2, 2, 2, 1, 2],   /* 1971 */
            [1, 2, 1, 1, 2, 1, 2, 1, 2, 2, 2, 1],
            [2, 1, 2, 1, 1, 2, 1, 1, 2, 2, 2, 1],
            [2, 2, 1, 5, 1, 2, 1, 1, 2, 2, 1, 2],
            [2, 2, 1, 2, 1, 1, 2, 1, 1, 2, 1, 2],
            [2, 2, 1, 2, 1, 2, 1, 5, 2, 1, 1, 2],
            [2, 1, 2, 2, 1, 2, 1, 2, 1, 2, 1, 1],
            [2, 2, 1, 2, 1, 2, 2, 1, 2, 1, 2, 1],
            [2, 1, 1, 2, 1, 6, 1, 2, 2, 1, 2, 1],
            [2, 1, 1, 2, 1, 2, 1, 2, 2, 1, 2, 2],
            [1, 2, 1, 1, 2, 1, 1, 2, 2, 1, 2, 2],   /* 1981 */
            [2, 1, 2, 3, 2, 1, 1, 2, 2, 1, 2, 2],
            [2, 1, 2, 1, 1, 2, 1, 1, 2, 1, 2, 2],
            [2, 1, 2, 2, 1, 1, 2, 1, 1, 5, 2, 2],
            [1, 2, 2, 1, 2, 1, 2, 1, 1, 2, 1, 2],
            [1, 2, 2, 1, 2, 2, 1, 2, 1, 2, 1, 1],
            [2, 1, 2, 2, 1, 5, 2, 2, 1, 2, 1, 2],
            [1, 1, 2, 1, 2, 1, 2, 2, 1, 2, 2, 1],
            [2, 1, 1, 2, 1, 2, 1, 2, 2, 1, 2, 2],
            [1, 2, 1, 1, 5, 1, 2, 1, 2, 2, 2, 2],
            [1, 2, 1, 1, 2, 1, 1, 2, 1, 2, 2, 2],   /* 1991 */
            [1, 2, 2, 1, 1, 2, 1, 1, 2, 1, 2, 2],
            [1, 2, 5, 2, 1, 2, 1, 1, 2, 1, 2, 1],
            [2, 2, 2, 1, 2, 1, 2, 1, 1, 2, 1, 2],
            [1, 2, 2, 1, 2, 2, 1, 5, 2, 1, 1, 2],
            [1, 2, 1, 2, 2, 1, 2, 1, 2, 2, 1, 2],
            [1, 1, 2, 1, 2, 1, 2, 2, 1, 2, 2, 1],
            [2, 1, 1, 2, 3, 2, 2, 1, 2, 2, 2, 1],
            [2, 1, 1, 2, 1, 1, 2, 1, 2, 2, 2, 1],
            [2, 2, 1, 1, 2, 1, 1, 2, 1, 2, 2, 1],
            [2, 2, 2, 3, 2, 1, 1, 2, 1, 2, 1, 2],   /* 2001 */
            [2, 2, 1, 2, 1, 2, 1, 1, 2, 1, 2, 1],
            [2, 2, 1, 2, 2, 1, 2, 1, 1, 2, 1, 2],
            [1, 5, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2],
            [1, 2, 1, 2, 1, 2, 2, 1, 2, 2, 1, 1],
            [2, 1, 2, 1, 2, 1, 5, 2, 2, 1, 2, 2],
            [1, 1, 2, 1, 1, 2, 1, 2, 2, 2, 1, 2],
            [2, 1, 1, 2, 1, 1, 2, 1, 2, 2, 1, 2],
            [2, 2, 1, 1, 5, 1, 2, 1, 2, 1, 2, 2],
            [2, 1, 2, 1, 2, 1, 1, 2, 1, 2, 1, 2],
            [2, 1, 2, 2, 1, 2, 1, 1, 2, 1, 2, 1],   /* 2011 */
            [2, 1, 6, 2, 1, 2, 1, 1, 2, 1, 2, 1],
            [2, 1, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2],
            [1, 2, 1, 2, 1, 2, 1, 2, 5, 2, 1, 2],
            [1, 2, 1, 1, 2, 1, 2, 2, 2, 1, 2, 1],
            [2, 1, 2, 1, 1, 2, 1, 2, 2, 1, 2, 2],
            [2, 1, 1, 2, 3, 2, 1, 2, 1, 2, 2, 2],
            [1, 2, 1, 2, 1, 1, 2, 1, 2, 1, 2, 2],
            [2, 1, 2, 1, 2, 1, 1, 2, 1, 2, 1, 2],
            [2, 1, 2, 5, 2, 1, 1, 2, 1, 2, 1, 2],
            [1, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1],   /* 2021 */
            [2, 1, 2, 1, 2, 2, 1, 2, 1, 2, 1, 2],
            [1, 5, 2, 1, 2, 1, 2, 2, 1, 2, 1, 2],
            [1, 2, 1, 1, 2, 1, 2, 2, 1, 2, 2, 1],
            [2, 1, 2, 1, 1, 5, 2, 1, 2, 2, 2, 1],
            [2, 1, 2, 1, 1, 2, 1, 2, 1, 2, 2, 2],
            [1, 2, 1, 2, 1, 1, 2, 1, 1, 2, 2, 2],
            [1, 2, 2, 1, 5, 1, 2, 1, 1, 2, 2, 1],
            [2, 2, 1, 2, 2, 1, 1, 2, 1, 1, 2, 2],
            [1, 2, 1, 2, 2, 1, 2, 1, 2, 1, 2, 1],
            [2, 1, 5, 2, 1, 2, 2, 1, 2, 1, 2, 1],   /* 2031 */
            [2, 1, 1, 2, 1, 2, 2, 1, 2, 2, 1, 2],
            [1, 2, 1, 1, 2, 1, 2, 1, 2, 2, 5, 2],
            [1, 2, 1, 1, 2, 1, 2, 1, 2, 2, 2, 1],
            [2, 1, 2, 1, 1, 2, 1, 1, 2, 2, 1, 2],
            [2, 2, 1, 2, 1, 4, 1, 1, 2, 2, 1, 2],
            [2, 2, 1, 2, 1, 1, 2, 1, 1, 2, 1, 2],
            [2, 2, 1, 2, 1, 2, 1, 2, 1, 1, 2, 1],
            [2, 2, 1, 2, 5, 2, 1, 2, 1, 2, 1, 1],
            [2, 1, 2, 2, 1, 2, 2, 1, 2, 1, 2, 1],
            [2, 1, 1, 2, 1, 2, 2, 1, 2, 2, 1, 2],   /* 2041 */
            [1, 5, 1, 2, 1, 2, 1, 2, 2, 2, 1, 2],
            [1, 2, 1, 1, 2, 1, 1, 2, 2, 1, 2, 2]
        ];

        const leapMonthData = {
            1900: { month: 8 }, 1903: { month: 5 }, 1906: { month: 4 },
            1909: { month: 2 }, 1911: { month: 6 }, 1914: { month: 5 },
            1917: { month: 2 }, 1919: { month: 7 }, 1922: { month: 5 },
            1925: { month: 4 }, 1928: { month: 2 }, 1930: { month: 6 },
            1933: { month: 5 }, 1936: { month: 3 }, 1938: { month: 7 },
            1941: { month: 6 }, 1944: { month: 4 }, 1947: { month: 2 },
            1949: { month: 7 }, 1952: { month: 5 }, 1955: { month: 3 },
            1957: { month: 8 }, 1960: { month: 8 }, 1963: { month: 4 },
            1966: { month: 3 }, 1968: { month: 7 }, 1971: { month: 5 },
            1974: { month: 4 }, 1976: { month: 8 }, 1979: { month: 6 },
            // 연도별 윤달 월 정보 추가
            1982: { month: 4 }, 1984: { month: 10 }, 1987: { month: 6 },
            1990: { month: 5 }, 1993: { month: 3 }, 1995: { month: 8 },
            1998: { month: 5 }, 2001: { month: 4 }, 2004: { month: 2 },
            2006: { month: 7 }, 2009: { month: 5 }, 2012: { month: 3 },
            2014: { month: 9 }, 2017: { month: 5 }, 2020: { month: 4 },
            2023: { month: 2 }, 2025: { month: 6 }, 2028: { month: 5 },
            2031: { month: 3 }, 2033: { month: 11 }, 2036: { month: 6 },
            2039: { month: 5 }, 2042: { month: 2 }, 2044: { month: 7 },
            2047: { month: 5 }, 2050: { month: 3 }
        };

        // 타로 카드 정보
	const tarotCards = [
	    {
	        name: "마법사(The Magician)",
	        number: "1",
	        meaning: "재치만점 다재다능 인기쟁이. 그런만큼 영리해 눈치도 빠르고 잔머리도 잘 굴려요. " + 
	                "유머러스한 면이 있고 창의적인 발상을 잘 해요. 재능은 많은데 끈기는 약간 부족하기도 해요."
	    },
	    {
	        name: "여사제(The High Priestess)",
	        number: "2",
	        meaning: "감정보단 이성적이며 꼼꼼하고 차분한 성향. 소심한 면이 있어 표현보단 생각이 많고 " + 
	                "추진력은 약한 편이지만, 예의와 교양이 있고 똑똑해요."
	    },
	    {
	        name: "여왕(The Empress)",
	        number: "3",
	        meaning: "자신감 넘치는 리더쉽 있는 성향. 오지랖과 인맥관리도 나의 특기. 나만의 타이틀을 갖는 걸 좋아하고 " + 
	                "때로는 물질적인 것에 소유욕과 행복을 느껴요. 활동적이지만 스트레스도 잘 받는 편이에요."
	    },
	    {
	        name: "황제(The Emperor)",
	        number: "4",
	        meaning: "책임감 강하고 자신감 넘치는 리더 중의 리더. 명예와 권력 욕구가 있고 그릇도 큰 성향이에요. " + 
	                "목표가 생기는 순간 추진력 발동! 무에서 유를 창출하는 능력도 뛰어나요."
	    },
	    {
	        name: "교황(The Hierophant)",
	        number: "5",
	        meaning: "포용력 있고 아는 것도 많아 믿음과 신뢰가 가는 타입. 그래서인지 주변에 나를 따르는 추종자들이 많아요. " + 
	                "온화한 분위기로 편안함을 주지만 때로는 은근 보수적이기도 해요."
	    },
	    {
	        name: "연인들(The Lovers)",
	        number: "6",
	        meaning: "솔직담백하고 사교적인 끼 많은 인기쟁이. 배려심이 높아 주변에 늘 사람이 많고 인복도 많아요. " + 
	                "인간관계를 중시하며 은근 소유욕이 강하고 가끔은 시기 질투를 하기도 해요."
	    },
	    {
	        name: "전차(The Chariot)",
	        number: "7",
	        meaning: "추진력 1등, 박력 넘치는 상남자 혹은 여장부. 일도 사랑도 모두 열정적으로 균형있게. " + 
	                "사업가 타입이라 일도 야무지게 전략적으로 척척. 한편 자존심이 강하고 욱하는 성향도 있어요."
	    },
	    {
	        name: "힘(Strength)",
	        number: "8",
	        meaning: "뭐든지 열심히, 뭘해도 잘해내는 끈기 만렙. 습득도 빠르고 적응도 잘 하고 나만의 고집과 승부욕이 있어요. " + 
	                "한편으론 나의 것에 대한 집착도 약간 있는 편이에요."
	    },
	    {
	        name: "은둔자(The Hermit)",
	        number: "9",
	        meaning: "한 분야를 파면 오래 걸려도 깊게 파고드는 끈질긴 성향. 새로운 것보다는 경험했던 옛것 추구. " + 
	                "성실하고 잔정도 많고 약간은 고집불통인 편이에요. 혼자 있어도 편안해요."
	    },
	    {
	        name: "운명의 수레바퀴(Wheel of Fortune)",
	        number: "10",
	        meaning: "다재다능 호기심 많은 변화무쌍의 아이콘. 끼도 많고 꾀도 많아 가만히 있지 못해요. " + 
	                "약간은 산만해보이고 끈기는 부족하지만, 특유의 감각과 기발한 발상으로 뭐든지 해내요."
	    },
	    {
	        name: "정의(Justice)",
	        number: "11",
	        meaning: "원리원칙 FM 스타일. 융통성은 조금 부족해 보일 수 있으나 이성적으로 법과 질서를 잘 지키는 신중한 성향이에요. " + 
	                "공평한 것을 좋아하고, 생각이 많아요. 때로는 조금 게으름도 피워요."
	    },
	    {
	        name: "매달린 사람(The Hanged Man)",
	        number: "12",
	        meaning: "걸어다니는 아이디어 뱅크. 남들이 생각 못하는 독특한 역발상적 감각의 소유자. " + 
	                "어디 하나에 빠지면 푹 빠지고, 나만 바라봐주길 바라기도 해요. 가끔 엉뚱하긴 하지만 역경을 잘 극복하는 의지와 인내심이 강해요."
	    },
	    {
	        name: "죽음(Death)",
	        number: "13",
	        meaning: "무에서 유를 창출해내는 능력의 소유자. 모험심이 강하고 총명하여 큰 일을 도모하는 타입. " + 
	                "때로는 두려움과 경계심에 극단적이고 비관적일 때도 있어요. 그러나 넘어져도 일어나는 부활의 힘이 있어요."
	    },
	    {
	        name: "절제(Temperance)",
	        number: "14",
	        meaning: "착한 심성과 순둥한 성격으로 정이 많고 남을 잘 배려해요. 섬세하고 꼼꼼하지만, " + 
	                "늘 눈치를 보거나 주도적이지 못해 우유부단해 보일때가 있어요. 하지만 참을성이 남들보다 높고 이성적 판단으로 절제하는 능력이 있어요."
	    },
	    {
	        name: "악마(The Devil)",
	        number: "15",
	        meaning: "원리원칙보단 감정과 본능으로 움직이는 스타일. 의리빼면 시체. 쿨하고 리더쉽 있는 능수능란 인맥관리의 달인. " + 
	                "내면의 똘끼와 내 마음 가는대로 하는 듯 해도 다 가질수 있는 능력과 힘, 그리고 재능이 있어요."
	    },
	    {
	        name: "흔들리는 탑(The Tower)",
	        number: "16",
	        meaning: "도전정신이 강하고 목표가 크고 선명한 타입. 남에게 맞추기보단 나만의 스타일이 있고 순발력과 승부욕도 강하기 때문에 " + 
	                "때로는 우월감에 주변의 시기와 질투를 받기도 해요."
	    },
	    {
	        name: "별(The Star)",
	        number: "17",
	        meaning: "다재다능 인기 넘치는 만인의 연인. 화려한 것을 좋아하고 자기애가 강해 본인도 시기 질투가 많고 주변에 시기 질투를 받기도 해요. " + 
	                "감수성이 예민하고 마음속에 약간의 불안감도 있어요. 나 자체를 인정해주는 사람을 좋아해요."
	    },
	    {
	        name: "달(The Moon)",
	        number: "18",
	        meaning: "타고난 촉과 예리한 직관력의 소유자. 보기에는 단단하고 포용력 있어보이나 속은 여리고 감정기복이 심한 편이에요. " + 
	                "잔정이 많아 사람들과 금방 친해지지만, 한번 아니다 싶으면 바로 돌아서기도 해요."
	    },
	    {
	        name: "태양(The Sun)",
	        number: "19",
	        meaning: "생기발랄 활동적이고 사교적인 타입. 늘 밝고 명랑한 태도로 주변 사람들을 즐겁게 해서 인기가 많아요. " + 
	                "한편으론 외로움도 잘 타며, 주목받고 인정 받길 원해요. 신용을 중시해 스스로도 진실된 사람이고 싶어해요."
	    },
	    {
	        name: "심판, 부활(Judgement)",
	        number: "20",
	        meaning: "논리정연하게 말하는 솔직한 돌직구 타입의 소유자. 부지런하고 성실하며 눈치도 빨라 나에게 주어진 일도 잘 해내요. " + 
	                "자신만의 독립적인 힘과 신념이 있고 남들보다 멘탈이 더욱 강한 것도 특징이에요."
	    },
	    {
	        name: "세계(The World)",
	        number: "21",
	        meaning: "내가 해야 직성이 풀리는 스스로를 달달 볶는 완벽주의자. 그런만큼 성공할 수 있는 에너지가 강하고 목표와 야망도 큰 편이에요. " + 
	                "능력이 출중하고 다재다능하며, 나만의 틀과 고집이 있어요."
	    },
	    {
	        name: "바보(The Fool)",
	        number: "0",
	        meaning: "순수하고 천진난만한 영혼의 소유자. 자유분방하고 사교적이며, 때로는 충동적이고 감정기복 있는 기분파. " + 
	                "남을 의식하기보단 내 주관이 뚜렷해요."
	    }
	];

        // myDate 객체 정의
        function myDate(year, month, day, leapMonth) {
            this.year = year;
            this.month = month;
            this.day = day;
            this.leapMonth = leapMonth;
        }

        function lunarCalc(year, month, day, type, leapmonth) {
            var solYear, solMonth, solDay;
            var lunYear, lunMonth, lunDay;

            // lunLeapMonth는 음력의 윤달인지 아닌지를 확인하기위한 변수
            // 1일 경우 윤달이고 0일 경우 음달
            var lunLeapMonth, lunMonthDay;
            var i, lunIndex;

            var solMonthDay = [31, 0, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

            /* range check */
            if (year < 1940 || year > 2025) {
                throw new Error('1940년부터 2040년까지만 지원합니다');
            }

            /* 속도 개선을 위해 기준 일자를 여러개로 한다 */
            if (year >= 2000) {
                /* 기준일자 양력 2000년 1월 1일 (음력 1999년 11월 25일) */
                solYear = 2000;
                solMonth = 1;
                solDay = 1;
                lunYear = 1999;
                lunMonth = 11;
                lunDay = 25;
                lunLeapMonth = 0;

                solMonthDay[1] = 29;    /* 2000 년 2월 28일 */
                lunMonthDay = 30;   /* 1999년 11월 */
            }
            else if (year >= 1970) {
                /* 기준일자 양력 1970년 1월 1일 (음력 1969년 11월 24일) */
                solYear = 1970;
                solMonth = 1;
                solDay = 1;
                lunYear = 1969;
                lunMonth = 11;
                lunDay = 24;
                lunLeapMonth = 0;

                solMonthDay[1] = 28;    /* 1970 년 2월 28일 */
                lunMonthDay = 30;   /* 1969년 11월 */
            }
            else {
                /* 기준일자 양력 1940년 1월 1일 (음력 1939년 11월 22일) */
                solYear = 1940;
                solMonth = 1;
                solDay = 1;
                lunYear = 1939;
                lunMonth = 11;
                lunDay = 22;
                lunLeapMonth = 0;

                solMonthDay[1] = 29;    /* 1940 년 2월 28일 */
                lunMonthDay = 29;   /* 1939년 11월 */
            }

            lunIndex = lunYear - LUNAR_LAST_YEAR;

            // type이 1일때는 입력받은 양력 값에 대한 음력값을 반환
            // 2일 때는 입력받은 음력 값에 대한 양력값을 반환
            // 반복문이 돌면서 양력 값들과 음력 값들을 1일 씩 증가시키고
            // 입력받은 날짜값과 양력 값이 일치할 때 음력값을 반환함
            while (true) {
                if (type == 1 &&
                    year == solYear &&
                    month == solMonth &&
                    day == solDay) {
                    return new myDate(lunYear, lunMonth, lunDay, lunLeapMonth);
                }
                else if (type == 2 &&
                    year == lunYear &&
                    month == lunMonth &&
                    day == lunDay &&
                    leapmonth == lunLeapMonth) {
                    return new myDate(solYear, solMonth, solDay, 0);
                }

                // 양력의 마지막 날일 경우 년도를 증가시키고 나머지 초기화
                if (solMonth == 12 && solDay == 31) {
                    solYear++;
                    solMonth = 1;
                    solDay = 1;

                    // 윤년일 시 2월달의 총 일수를 1일 증가
                    if (solYear % 400 == 0)
                        solMonthDay[1] = 29;
                    else if (solYear % 100 == 0)
                        solMonthDay[1] = 28;
                    else if (solYear % 4 == 0)
                        solMonthDay[1] = 29;
                    else
                        solMonthDay[1] = 28;

                }
                // 현재 날짜가 달의 마지막 날짜를 가리키고 있을 시 달을 증가시키고 날짜 1로 초기화
                else if (solMonthDay[solMonth - 1] == solDay) {
                    solMonth++;
                    solDay = 1;
                }
                else
                    solDay++;

                // 음력의 마지막 날인 경우 년도를 증가시키고 달과 일수를 초기화
                if (lunMonth == 12 &&
                    ((lunarMonthTable[lunIndex][lunMonth - 1] == 1 && lunDay == 29) ||
                        (lunarMonthTable[lunIndex][lunMonth - 1] == 2 && lunDay == 30))) {
                    lunYear++;
                    lunMonth = 1;
                    lunDay = 1;

                    if (lunYear > 2043) {
                        alert("입력하신 달은 없습니다.");
                        break;
                    }

                    // 년도가 바꼈으니 index값 수정
                    lunIndex = lunYear - LUNAR_LAST_YEAR;

                    // 음력의 1월에는 1 or 2만 있으므로 1과 2만 비교하면됨
                    if (lunarMonthTable[lunIndex][lunMonth - 1] == 1)
                        lunMonthDay = 29;
                    else if (lunarMonthTable[lunIndex][lunMonth - 1] == 2)
                        lunMonthDay = 30;
                }
                // 현재날짜가 이번달의 마지막날짜와 일치할 경우
                else if (lunDay == lunMonthDay) {

                    // 윤달인데 윤달계산을 안했을 경우 달의 숫자는 증가시키면 안됨
                    if (lunarMonthTable[lunIndex][lunMonth - 1] >= 3
                        && lunLeapMonth == 0) {
                        lunDay = 1;
                        lunLeapMonth = 1;
                    }
                    // 음달이거나 윤달을 계산 했을 겨우 달을 증가시키고 lunLeapMonth값 초기화
                    else {
                        lunMonth++;
                        lunDay = 1;
                        lunLeapMonth = 0;
                    }

                    // 음력의 달에 맞는 마지막날짜 초기화
                    if (lunarMonthTable[lunIndex][lunMonth - 1] == 1)
                        lunMonthDay = 29;
                    else if (lunarMonthTable[lunIndex][lunMonth - 1] == 2)
                        lunMonthDay = 30;
                    else if (lunarMonthTable[lunIndex][lunMonth - 1] == 3)
                        lunMonthDay = 29;
                    else if (lunarMonthTable[lunIndex][lunMonth - 1] == 4 &&
                        lunLeapMonth == 0)
                        lunMonthDay = 29;
                    else if (lunarMonthTable[lunIndex][lunMonth - 1] == 4 &&
                        lunLeapMonth == 1)
                        lunMonthDay = 30;
                    else if (lunarMonthTable[lunIndex][lunMonth - 1] == 5 &&
                        lunLeapMonth == 0)
                        lunMonthDay = 30;
                    else if (lunarMonthTable[lunIndex][lunMonth - 1] == 5 &&
                        lunLeapMonth == 1)
                        lunMonthDay = 29;
                    else if (lunarMonthTable[lunIndex][lunMonth - 1] == 6)
                        lunMonthDay = 30;
                }
                else
                    lunDay++;
                            // 윤달 체크 로직 추가
            function isLeapMonth(year, month) {
                return leapMonthData[year] && leapMonthData[year].month === month;
            }
        
            // lunarCalc 함수 내에서 윤달 처리 수정
            if (type === 2) { // 음력 -> 양력 변환 시
                if (leapmonth && !isLeapMonth(year, month)) {
                    throw new Error('해당 월은 윤달이 아닙니다.');
                }
            }
            }
        }


        function solarToLunar(solYear, solMonth, solDay) {
            // 날짜 형식이 안맞을 경우 공백 반환
            if (!solYear || solYear == 0 ||
                !solMonth || solMonth == 0 ||
                !solDay || solDay == 0) {
                return "";
            }

            // 양력의 달마다의 일수
            var solMonthDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

            // 윤년일 시 2월에 1일 추가
            if (solYear % 400 == 0 || (solYear % 4 == 0 && solYear % 100 != 0)) solMonthDays[1] += 1;


            if (solMonth < 1 || solMonth > 12 ||
                solDay < 1 || solDay > solMonthDays[solMonth - 1]) {

                return "";
            }

            /* 양력/음력 변환 */
            var date = lunarCalc(solYear, solMonth, solDay, 1);

            return "음력 " + date.year + "년 " + (date.leapMonth ? "(윤)" : "") + date.month + "월 " + date.day;
        }

        // 날짜 변환 함수 수정
        function convertDate(year, month, day, isSolar) {
            try {
                if (isSolar) {
                    // 양력 -> 음력 변환
                    const lunarDate = lunarCalc(year, month, day, 1);
                    const isLeap = leapMonthData[lunarDate.year] && 
                                  leapMonthData[lunarDate.year].month === lunarDate.month;
                    
                    return {
                        solar: { year, month, day },
                        lunar: {
                            year: lunarDate.year,
                            month: lunarDate.month,
                            day: lunarDate.day,
                            isLeap: isLeap
                        }
                    };
                } else {
                    // 음력 -> 양력 변환
                    const isLeap = leapMonthData[year] && leapMonthData[year].month === month;
                    const solarDate = lunarCalc(year, month, day, 2, isLeap ? 1 : 0);
                    
                    return {
                        solar: {
                            year: solarDate.year,
                            month: solarDate.month,
                            day: solarDate.day
                        },
                        lunar: { 
                            year, 
                            month, 
                            day,
                            isLeap: isLeap
                        }
                    };
                }
            } catch (error) {
                console.error('날짜 변환 중 오류:', error);
                throw new Error('날짜 변환 중 오류가 발생했습니다. 올바른 날짜를 선택해주세요.');
            }
        }

        // 나머지 기존 함수들
	function initializeDateSelects() {
    	// year select
    	const yearSelect = document.getElementById('year');
    	yearSelect.innerHTML = '<option value="">년도</option>';
    	// 1940년부터 2040년까지로 제한
    	for (let y = 2025; y >= 1940; y--) {
        	yearSelect.innerHTML += `<option value="${y}">${y}년</option>`;
    	}

    	// month select
    	const monthSelect = document.getElementById('month');
    	monthSelect.innerHTML = '<option value="">월</option>';
    	for (let m = 1; m <= 12; m++) {
        	const monthValue = m.toString().padStart(2, '0');
        	monthSelect.innerHTML += `<option value="${monthValue}">${m}월</option>`;
    	}

    	// day select - 초기값은 31일로 설정
    	const daySelect = document.getElementById('day');
    	daySelect.innerHTML = '<option value="">일</option>';
    	for (let d = 1; d <= 31; d++) {
        	const dayValue = d.toString().padStart(2, '0');
        	daySelect.innerHTML += `<option value="${dayValue}">${d}일</option>`;
    	}
}

        function updateDays() {
            const year = parseInt(yearSelect.value) || currentYear;
            const month = parseInt(monthSelect.value) || 1;
            const lastDay = new Date(year, month, 0).getDate();

            daySelect.innerHTML = '<option value="">일</option>';
            for (let d = 1; d <= lastDay; d++) {
                daySelect.innerHTML += `<option value="${d.toString().padStart(2, '0')}">${d}일</option>`;
            }

            if (parseInt(daySelect.value) > lastDay) {
                daySelect.value = '';
            }
        }
	    
	// URL 복사 함수
        function copyUrl() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('주소가 클립보드에 복사되었습니다.');
            }).catch(err => {
                console.error('URL 복사 실패:', err);
                alert('주소 복사에 실패했습니다.');
            });
        }

        // 공유하기 함수
        function shareUrl() {
            if (navigator.share) {
                navigator.share({
                    title: 'Tarot Birth-Card Reading',
                    url: window.location.href
                }).catch(err => {
                    console.error('공유하기 실패:', err);
                });
            } else {
                copyUrl(); // 공유 API를 지원하지 않는 경우 URL 복사로 대체
            }
        }

        // 초기화
        initializeDateSelects();
	    
        function calculateCards() {
            if (!validateInputs()) return;
        
            const year = parseInt(yearSelect.value);
            const month = parseInt(monthSelect.value);
            const day = parseInt(daySelect.value);
            const isSolar = document.querySelector('input[name="calendarType"]:checked').value === 'solar';
        
            try {
                const dateInfo = convertDate(year, month, day, isSolar);
        
                // 결과 표시
                document.getElementById('solarDate').textContent = 
                    `양력: ${dateInfo.solar.year}년 ${dateInfo.solar.month}월 ${dateInfo.solar.day}일`;
                document.getElementById('lunarDate').textContent = 
                    `음력: ${dateInfo.lunar.year}년 ${dateInfo.lunar.month}월 ${dateInfo.lunar.day}일`;
        
                // 양력 계산
                const solarInitialSum = dateInfo.solar.year + dateInfo.solar.month + dateInfo.solar.day;
                const solarResult = calculateBirthNumber(solarInitialSum);
                
                // 음력 계산
                const lunarInitialSum = dateInfo.lunar.year + dateInfo.lunar.month + dateInfo.lunar.day;
                const lunarResult = calculateBirthNumber(lunarInitialSum);
        
                // 카드 정보 표시
                displayCardInfo('solarCardInfo', solarResult.finalSum);
                displayCardInfo('lunarCardInfo', lunarResult.finalSum);
                displayCardInfo('shadowCardInfo', 22 - solarResult.finalSum);
        
                // 소울 카드: 첫 번째 합계가 22 이상일 때만 계산
                if (solarResult.firstSum >= 22) {
                    displayCardInfo('soulCardInfo', solarResult.firstSum - 22);
                } else {
                    displayCardInfo('soulCardInfo', null);
                }
                document.getElementById('errorContainer').textContent = '';

            } catch (error) {
                console.error('Error in calculateCards:', error);
                document.getElementById('errorContainer').textContent = error.message;
                clearDisplays();
            }
        }


        function validateInputs() {
            if (!yearSelect.value || !monthSelect.value || !daySelect.value) {
                document.getElementById('errorContainer').textContent = '';
                return false;
            }
            return true;
        }


        function calculateBirthNumber(number) {
            // 생년월일 합계의 각 자리수를 더한 첫 번째 결과
            const firstSum = String(number).split('').map(Number).reduce((a, b) => a + b, 0);
            
            // 21을 초과하는 경우에만 한번 더 각 자리수를 더함
            if (firstSum > 21) {
                const finalSum = String(firstSum).split('').map(Number).reduce((a, b) => a + b, 0);
                return {
                    firstSum: firstSum,  // 소울 카드 계산용
                    finalSum: finalSum   // 최종 카드 번호
                };
            }
            
            return {
                firstSum: firstSum,
                finalSum: firstSum
            };
        }


        function displayCardInfo(elementId, cardNumber) {
            const cardInfoDiv = document.getElementById(elementId);
            const cardImageId = elementId.replace('CardInfo', 'CardImage');
            const cardImage = document.getElementById(cardImageId);
            
            // 소울 카드이고 숫자가 null인 경우
            if (cardNumber === null || cardNumber === undefined) {
                cardInfoDiv.innerHTML = `
                    <div class="card-name">-</div>
                    <div class="card-meaning">해당 없음</div>
                `;
                cardImage.style.display = 'none';
                return;
            }
            
            // 카드 번호에 맞는 타로 카드 정보 가져오기
            const normalizedCardNumber = (cardNumber - 1 + tarotCards.length) % tarotCards.length;
            const card = tarotCards[normalizedCardNumber];
            
            // 이미지 경로 설정 (카드 번호에 맞게)
            const cardNum = card.number;
            cardImage.src = `tarot-${cardNum}.png`; // 이미지 파일 확장자에 맞게 수정
            cardImage.alt = card.name;
            cardImage.style.display = 'block';
            
            // 카드 정보 표시
            cardInfoDiv.innerHTML = `
                <div class="card-name">${card.number}. ${card.name}</div>
                <div class="card-meaning">${card.meaning}</div>
            `;
        }

        function clearDisplays() {
            document.getElementById('solarDate').textContent = '양력: -';
            document.getElementById('lunarDate').textContent = '음력: -';
            document.getElementById('solarCardInfo').innerHTML = '';
            document.getElementById('lunarCardInfo').innerHTML = '';
            document.getElementById('shadowCardInfo').innerHTML = '';
            document.getElementById('soulCardInfo').innerHTML = '';
            
            // 이미지 초기화
            document.getElementById('solarCardImage').style.display = 'none';
            document.getElementById('lunarCardImage').style.display = 'none';
            document.getElementById('shadowCardImage').style.display = 'none';
            document.getElementById('soulCardImage').style.display = 'none';
        }

        // 이미지 로드 오류 처리
        document.querySelectorAll('.card-image').forEach(img => {
            img.onerror = function() {
                this.src = 'tarot-default.png'; // 기본 이미지
                if(this.src.includes('tarot-default.png')) {
                    this.style.display = 'none'; // 기본 이미지도 없으면 숨김
                }
            };
        });
	// 결과 복사 함수
	function copyResult() {
	    const cardResults = document.querySelector('.card-result');
	    const solarDate = document.getElementById('solarDate').textContent;
	    const lunarDate = document.getElementById('lunarDate').textContent;
	    
	    // 양력 날짜, 음력 날짜 정보 포함
	    let text = `${solarDate}\n${lunarDate}\n\n`;
	    
	    // 각 카드 정보 추가
	    Array.from(cardResults.querySelectorAll('.card')).forEach(card => {
	        const title = card.querySelector('h3').textContent;
	        const description = card.querySelector('.card-description') ? 
	                           card.querySelector('.card-description').textContent : '';
	        const info = card.querySelector('.card-info').textContent.trim();
	        
	        text += `${title} (${description})\n`;
	        if (info) {
	            const cardName = info.split('\n')[0].trim();
	            const cardMeaning = info.split('\n')[1] ? info.split('\n')[1].trim() : '';
	            text += `${cardName}\n${cardMeaning}`;
	        }
	        text += '\n\n';
	    });
	    
	    navigator.clipboard.writeText(text).then(() => {
	        const btn = document.getElementById('copyBtn');
	        btn.innerHTML = '복사 완료!';
	        setTimeout(() => {
	            btn.innerHTML = '<span>결과 복사</span>';
	        }, 2000);
	    });
	}
	// 이미지 저장 함수
	function saveImage() {
	    // 캡처할 요소
	    const cardResults = document.querySelector('.card-result');
	    
	    // 날짜 정보 가져오기
	    const solarDate = document.getElementById('solarDate').textContent;
	    const lunarDate = document.getElementById('lunarDate').textContent;
	    
	    // 임시 날짜 정보 요소 생성
	    const dateInfo = document.createElement('div');
	    dateInfo.style.textAlign = 'left';
	    dateInfo.style.marginBottom = '15px';
	    dateInfo.style.color = '#666';
	    dateInfo.style.fontSize = '14px';
	    dateInfo.style.paddingLeft = '10px'; // 약간의 왼쪽 여백 추가
	    dateInfo.innerHTML = `${solarDate}<br>${lunarDate}`;
	    
	    // 임시 요소 생성해 원래 결과를 복제
	    const tempContainer = document.createElement('div');
	    tempContainer.style.backgroundColor = 'white';
	    tempContainer.style.padding = '20px';
	    tempContainer.style.borderRadius = '12px';
	    tempContainer.style.maxWidth = cardResults.offsetWidth + 'px';
	    
	    // 날짜 정보를 먼저 추가
	    tempContainer.appendChild(dateInfo);
	    
	    // 기존 결과 복제 추가
	    const clonedResults = cardResults.cloneNode(true);
	    tempContainer.appendChild(clonedResults);
	    
	    // 페이지에 임시로 추가
	    document.body.appendChild(tempContainer);
	    tempContainer.style.position = 'absolute';
	    tempContainer.style.left = '-9999px';
	    
	    // 이미지 생성
	    html2canvas(tempContainer).then(canvas => {
	        // 임시 요소 제거
	        document.body.removeChild(tempContainer);
	        
	        // 이미지 다운로드
	        const link = document.createElement('a');
	        link.download = 'tarot-reading.png';
	        link.href = canvas.toDataURL();
	        link.click();
	        
	        const btn = document.getElementById('saveBtn');
	        btn.innerHTML = '저장 완료!';
	        setTimeout(() => {
	            btn.innerHTML = '<span>결과 저장</span>';
	        }, 2000);
	    });
	}
	// 결과 공유 함수 수정
	async function shareResult() {
	    const cardResults = document.querySelector('.card-result');
	    const solarDate = document.getElementById('solarDate').textContent;
	    const lunarDate = document.getElementById('lunarDate').textContent;
	    
	    // 양력 날짜, 음력 날짜 정보 포함
	    let text = `${solarDate}\n${lunarDate}\n\n`;
	    
	    // 각 카드 정보 추가
	    Array.from(cardResults.querySelectorAll('.card')).forEach(card => {
	        const title = card.querySelector('h3').textContent;
	        const description = card.querySelector('.card-description') ? 
	                           card.querySelector('.card-description').textContent : '';
	        const info = card.querySelector('.card-info').textContent.trim();
	        
	        text += `${title} (${description})\n`;
	        if (info) {
	            const cardName = info.split('\n')[0].trim();
	            const cardMeaning = info.split('\n')[1] ? info.split('\n')[1].trim() : '';
	            text += `${cardName}\n${cardMeaning}`;
	        }
	        text += '\n\n';
	    });
	
	    try {
	        const canvas = await html2canvas(cardResults);
	        canvas.toBlob(async (blob) => {
	            const files = [new File([blob], 'tarot-reading.png', { type: 'image/png' })];
	            
	            if (navigator.share) {
	                try {
	                    await navigator.share({
	                        text: text,
	                        files: files
	                    });
	                    const btn = document.getElementById('shareBtn');
	                    btn.innerHTML = '공유 완료!';
	                    setTimeout(() => {
	                        btn.innerHTML = '<span>결과 공유</span>';
	                    }, 2000);
	                } catch (error) {
	                    try {
	                        await navigator.share({
	                            text: text
	                        });
	                        const btn = document.getElementById('shareBtn');
	                        btn.innerHTML = '공유 완료!';
	                        setTimeout(() => {
	                            btn.innerHTML = '<span>결과 공유</span>';
	                        }, 2000);
	                    } catch (error) {
	                        copyResult();
	                    }
	                }
	            } else {
	                copyResult();
	            }
	        });
	    } catch (error) {
	        if (navigator.share) {
	            try {
	                await navigator.share({
	                    text: text
	                });
	                const btn = document.getElementById('shareBtn');
	                btn.innerHTML = '공유 완료!';
	                setTimeout(() => {
	                    btn.innerHTML = '<span>결과 공유</span>';
	                }, 2000);
	            } catch (error) {
	                copyResult();
	            }
	        } else {
	            copyResult();
	        }
	    }
	}
	// 페이지 로드 시 모바일 체크 및 이벤트 리스너 설정
window.addEventListener('load', function() {
    // 공유 버튼 표시 여부 설정
    const shareBtn = document.getElementById('shareBtn');
    if (!navigator.share || !(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))) {
        shareBtn.style.display = 'none';
    }
    
    // 이미지 로드 오류 처리
    document.querySelectorAll('.card-image').forEach(img => {
        img.onerror = function() {
            this.src = 'tarot-default.png'; // 기본 이미지
            if(this.src.includes('tarot-default.png')) {
                this.style.display = 'none'; // 기본 이미지도 없으면 숨김
            }
        };
    });
    
    // 날짜 선택 요소에 이벤트 리스너 다시 추가
    document.getElementById('year').addEventListener('change', function() {
        updateDays();
        calculateCards();
    });
    document.getElementById('month').addEventListener('change', function() {
        updateDays();
        calculateCards();
    });
    document.getElementById('day').addEventListener('change', calculateCards);
    
    // 양력/음력 라디오 버튼에 이벤트 리스너 추가
    document.querySelectorAll('input[name="calendarType"]').forEach(radio => {
        radio.addEventListener('change', calculateCards);
    });
    
    // 초기 계산 실행 (이미 선택된 날짜가 있는 경우)
    if (document.getElementById('year').value && 
        document.getElementById('month').value && 
        document.getElementById('day').value) {
        calculateCards();
    }
});
    </script>
</body>
</html>
